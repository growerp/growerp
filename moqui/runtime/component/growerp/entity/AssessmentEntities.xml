<?xml version="1.0" encoding="UTF-8"?>
<!--
Assessment Entities for GrowERP Landing Page & Assessment System
Includes: Assessment, AssessmentQuestion, AssessmentQuestionOption, 
ScoringThreshold, and AssessmentResult entities
Multi-tenant support via ownerPartyId
Dual-ID strategy: entityNameId (system-wide) + pseudoId (tenant-unique)
-->
<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/entity-definition-3.xsd">

    <!-- Assessment Entity: Main assessment/survey definition -->
    <entity entity-name="Assessment" package="growerp.assessment" cache="true">
        <field name="assessmentId" type="id" is-pk="true" />
        <field name="pseudoId" type="id" />
        <field name="ownerPartyId" type="id" />
        <field name="companyPartyId" type="id" />
        <field name="assessmentName" type="text-medium" />
        <field name="description" type="text-long" />
        <field name="status" type="text-short" />
        <field name="createdDate" type="date-time" />
        <field name="createdByUserLogin" type="text-short" />
        <field name="lastModifiedDate" type="date-time" />
        <field name="lastModifiedByUserLogin" type="text-short" />

        <relationship type="one" title="Owner" related="mantle.party.Party" short-alias="owner">
            <key-map field-name="ownerPartyId" />
        </relationship>
        <relationship type="one" title="Company" related="mantle.party.Party" short-alias="company">
            <key-map field-name="companyPartyId" />
        </relationship>

        <!-- Indices -->
        <index name="assess_pseudoId_idx">
            <index-field name="pseudoId" />
        </index>
        <index name="ownerPartyId_idx">
            <index-field name="ownerPartyId" />
        </index>
    </entity>

    <!-- AssessmentQuestion: Individual questions within an assessment -->
    <entity entity-name="AssessmentQuestion" package="growerp.assessment" cache="true">
        <field name="assessmentQuestionId" type="id" is-pk="true" />
        <field name="pseudoId" type="id" />
        <field name="assessmentId" type="id" />
        <field name="questionSequence" type="number-integer" />
        <field name="questionType" type="text-short" />
        <field name="questionText" type="text-long" />
        <field name="questionDescription" type="text-long" />
        <field name="isRequired" type="text-indicator" />
        <field name="defaultOption" type="id" />
        <field name="defaultValue" type="text-long" />
        <field name="createdDate" type="date-time" />
        <field name="createdByUserLogin" type="text-short" />

        <relationship type="one" title="Assessment" related="growerp.assessment.Assessment"
            short-alias="assessment">
            <key-map field-name="assessmentId" />
        </relationship>
        <!-- Indices -->
        <index name="asses_question_pseudoId_idx">
            <index-field name="pseudoId" />
        </index>
        <index name="asses_question_assessmentId_idx">
            <index-field name="assessmentId" />
        </index>
    </entity>

    <!-- AssessmentQuestionOption: Answer options for multiple choice questions -->
    <entity entity-name="AssessmentQuestionOption" package="growerp.assessment" cache="true">
        <field name="assessmentQuestionOptionId" type="id" is-pk="true" />
        <field name="pseudoId" type="id" />
        <field name="assessmentQuestionId" type="id" />
        <field name="assessmentId" type="id" />
        <field name="optionSequence" type="number-integer" />
        <field name="optionText" type="text-medium" />
        <field name="optionScore" type="number-decimal" />
        <field name="createdDate" type="date-time" />

        <relationship type="one" title="AssessmentQuestion"
            related="growerp.assessment.AssessmentQuestion" short-alias="assessmentQuestion">
            <key-map field-name="assessmentQuestionId" />
        </relationship>
        <!-- Indices -->
        <index name="asses_question_option_pseudoId_idx">
            <index-field name="pseudoId" />
        </index>
        <index name="asses_question_option_assessmentQuestionId_idx">
            <index-field name="assessmentQuestionId" />
        </index>
    </entity>

    <!-- ScoringThreshold: Define score ranges and lead status -->
    <entity entity-name="ScoringThreshold" package="growerp.assessment" cache="true">
        <field name="scoringThresholdId" type="id" is-pk="true" />
        <field name="pseudoId" type="id" />
        <field name="assessmentId" type="id" />
        <field name="minScore" type="number-decimal" />
        <field name="maxScore" type="number-decimal" />
        <field name="leadStatus" type="text-short" />
        <field name="description" type="text-medium" />
        <field name="createdDate" type="date-time" />
        <field name="createdByUserLogin" type="text-short" />

        <relationship type="one" title="Assessment"
            related="growerp.assessment.Assessment" short-alias="assessment">
            <key-map field-name="assessmentId" />
        </relationship>
        <!-- Indices -->
        <index name="asses_scoringThreshold_pseudoId_idx">
            <index-field name="pseudoId" />
        </index>
        <index name="asses_scoringThreshold_assessmentId_idx">
            <index-field name="assessmentId" />
        </index>
    </entity>

    <!-- AssessmentResult: Stores assessment submission results -->
    <entity entity-name="AssessmentResult" package="growerp.assessment" cache="false">
        <field name="assessmentResultId" type="id" is-pk="true" />
        <field name="pseudoId" type="id" />
        <field name="assessmentId" type="id" />
        <field name="ownerPartyId" type="id" />
        <field name="score" type="number-decimal" />
        <field name="leadStatus" type="text-short" />
        <field name="respondentName" type="text-short" />
        <field name="respondentEmail" type="text-medium" />
        <field name="respondentPhone" type="text-short" />
        <field name="respondentCompany" type="text-medium" />
        <field name="capturedLeadId" type="id" />
        <field name="resultData" type="text-very-long" />
        <field name="answersData" type="text-very-long" />
        <field name="createdDate" type="date-time" />
        <field name="createdByUserLogin" type="text-short" />
        <field name="lastModifiedDate" type="date-time" />

        <relationship type="one" title="Assessment"
            related="growerp.assessment.Assessment" short-alias="assessment">
            <key-map field-name="assessmentId" />
        </relationship>
        <!-- Indices -->
        <index name="asses_result_pseudoId_idx">
            <index-field name="pseudoId" />
        </index>
        <index name="asses_result_ownerPartyId_idx">
            <index-field name="ownerPartyId" />
        </index>
        <index name="asses_result_assessmentId_idx">
            <index-field name="assessmentId" />
        </index>
    </entity>

    <!-- View Entity: Questions with Options (for efficient question list retrieval) -->
    <view-entity entity-name="QuestionAndOptions" package="growerp.assessment">
        <description>Assessment questions with their options in a single query</description>

        <!-- Assessment Questions (main entity) -->
        <member-entity entity-alias="AQ" entity-name="growerp.assessment.AssessmentQuestion" />

        <!-- Question Options (LEFT JOIN - questions may have no options) -->
        <member-entity entity-alias="AQO" entity-name="growerp.assessment.AssessmentQuestionOption"
            join-from-alias="AQ" join-optional="true">
            <key-map field-name="assessmentQuestionId" />
            <key-map field-name="assessmentId" />
        </member-entity>

        <!-- Question fields -->
        <alias entity-alias="AQ" name="assessmentQuestionId" />
        <alias entity-alias="AQ" name="pseudoId" />
        <alias entity-alias="AQ" name="assessmentId" />
        <alias entity-alias="AQ" name="questionSequence" />
        <alias entity-alias="AQ" name="questionType" />
        <alias entity-alias="AQ" name="questionText" />
        <alias entity-alias="AQ" name="questionDescription" />
        <alias entity-alias="AQ" name="isRequired" />
        <alias entity-alias="AQ" name="defaultOption" />
        <alias entity-alias="AQ" name="defaultValue" />
        <alias entity-alias="AQ" name="createdDate" />
        <alias entity-alias="AQ" name="createdByUserLogin" />

        <!-- Option fields (aliased to avoid conflicts) -->
        <alias entity-alias="AQO" name="optionId" field="assessmentQuestionOptionId" />
        <alias entity-alias="AQO" name="optionPseudoId" field="pseudoId" />
        <alias entity-alias="AQO" name="optionSequence" />
        <alias entity-alias="AQO" name="optionText" />
        <alias entity-alias="AQO" name="optionScore" />
        <alias entity-alias="AQO" name="optionCreatedDate" field="createdDate" />
    </view-entity>

    <!-- View Entity: Complete assessment with questions, options, and thresholds -->
    <view-entity entity-name="AssessmentComplete" package="growerp.assessment">
        <description>Complete assessment view with questions, options, and scoring thresholds</description>

        <!-- Assessment (main entity) -->
        <member-entity entity-alias="ASM" entity-name="growerp.assessment.Assessment" />

        <!-- Assessment Questions (optional - may have assessments without questions) -->
        <member-entity entity-alias="AQ" entity-name="growerp.assessment.AssessmentQuestion"
            join-from-alias="ASM" join-optional="true">
            <key-map field-name="assessmentId" />
        </member-entity>

        <!-- Question Options (optional - may have questions without options) -->
        <member-entity entity-alias="AQO" entity-name="growerp.assessment.AssessmentQuestionOption"
            join-from-alias="AQ" join-optional="true">
            <key-map field-name="assessmentQuestionId" />
            <key-map field-name="assessmentId" />
        </member-entity>

        <!-- Scoring Thresholds (optional - may have assessments without thresholds) -->
        <member-entity entity-alias="ST" entity-name="growerp.assessment.ScoringThreshold"
            join-from-alias="ASM" join-optional="true">
            <key-map field-name="assessmentId" />
        </member-entity>

        <!-- Assessment fields -->
        <alias entity-alias="ASM" name="assessmentId" />
        <alias entity-alias="ASM" name="assessmentPseudoId" field="pseudoId" />
        <alias entity-alias="ASM" name="ownerPartyId" />
        <alias entity-alias="ASM" name="assessmentName" />
        <alias entity-alias="ASM" name="assessmentDescription" field="description" />
        <alias entity-alias="ASM" name="assessmentStatus" field="status" />
        <alias entity-alias="ASM" name="assessmentCreatedDate" field="createdDate" />
        <alias entity-alias="ASM" name="assessmentCreatedByUserLogin" field="createdByUserLogin" />
        <alias entity-alias="ASM" name="assessmentLastModifiedDate" field="lastModifiedDate" />
        <alias entity-alias="ASM" name="assessmentLastModifiedByUserLogin"
            field="lastModifiedByUserLogin" />

        <!-- Question fields -->
        <alias entity-alias="AQ" name="assessmentQuestionId" />
        <alias entity-alias="AQ" name="questionPseudoId" field="pseudoId" />
        <alias entity-alias="AQ" name="questionSequence" />
        <alias entity-alias="AQ" name="questionType" />
        <alias entity-alias="AQ" name="questionText" />
        <alias entity-alias="AQ" name="questionDescription" />
        <alias entity-alias="AQ" name="isRequired" />
        <alias entity-alias="AQ" name="defaultOption" />
        <alias entity-alias="AQ" name="defaultValue" />
        <alias entity-alias="AQ" name="questionCreatedDate" field="createdDate" />
        <alias entity-alias="AQ" name="questionCreatedByUserLogin" field="createdByUserLogin" />

        <!-- Option fields -->
        <alias entity-alias="AQO" name="assessmentQuestionOptionId" />
        <alias entity-alias="AQO" name="optionPseudoId" field="pseudoId" />
        <alias entity-alias="AQO" name="optionSequence" />
        <alias entity-alias="AQO" name="optionText" />
        <alias entity-alias="AQO" name="optionScore" />
        <alias entity-alias="AQO" name="optionCreatedDate" field="createdDate" />

        <!-- Threshold fields -->
        <alias entity-alias="ST" name="scoringThresholdId" />
        <alias entity-alias="ST" name="thresholdPseudoId" field="pseudoId" />
        <alias entity-alias="ST" name="minScore" />
        <alias entity-alias="ST" name="maxScore" />
        <alias entity-alias="ST" name="leadStatus" />
        <alias entity-alias="ST" name="thresholdDescription" field="description" />
        <alias entity-alias="ST" name="thresholdCreatedDate" field="createdDate" />
        <alias entity-alias="ST" name="thresholdCreatedByUserLogin" field="createdByUserLogin" />
    </view-entity>

</entities>