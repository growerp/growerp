<?xml version="1.0" encoding="UTF-8"?>
<!--
Landing Page Entities for GrowERP Landing Page System
Includes: LandingPage, PageSection, CredibilityInfo, CredibilityStatistic
Multi-tenant support via ownerPartyId
Dual-ID strategy: entityNameId (system-wide) + pseudoId (tenant-unique)
-->
<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/entity-definition-3.xsd">

  <!-- LandingPage: Main landing page definition -->
  <entity entity-name="LandingPage" package="growerp.landing" cache="true">
    <field name="landingPageId" type="id" is-pk="true" />
    <field name="pseudoId" type="id" />
    <field name="ownerPartyId" type="id" />
    <field name="companyPartyId" type="id" />
    <field name="title" type="text-medium" not-null="true" />
    <field name="hookType" type="text-short" />
    <field name="headline" type="text-long" />
    <field name="subheading" type="text-long" />
    <field name="status" type="text-short" />
    <field name="privacyPolicyUrl" type="text-long" />
    <field name="ctaActionType" type="text-short" />
    <field name="ctaAssessmentId" type="id" />
    <field name="ctaButtonLink" type="text-long" />
    <field name="createdDate" type="date-time" />
    <field name="createdByUserLogin" type="text-short" />
    <field name="lastModifiedDate" type="date-time" />
    <field name="lastModifiedByUserLogin" type="text-short" />

    <relationship type="one" title="Owner" related="mantle.party.Party" short-alias="owner">
      <key-map field-name="ownerPartyId" />
    </relationship>
    <relationship type="one" title="Company" related="mantle.party.Party" short-alias="company">
      <key-map field-name="companyPartyId" />
    </relationship>
    <relationship type="one" title="Assessment" related="growerp.assessment.Assessment"
      short-alias="assessment">
      <key-map field-name="ctaAssessmentId" related="assessmentId" />
    </relationship>
    <!-- Indices -->
    <index name="landing_pseudoId_idx">
      <index-field name="pseudoId" />
    </index>
    <index name="landing_ownerPartyId_idx">
      <index-field name="ownerPartyId" />
    </index>
  </entity>

  <!-- PageSection: Content sections on landing page -->
  <entity entity-name="PageSection" package="growerp.landing" cache="true">
    <field name="pageSectionId" type="id" is-pk="true" />
    <field name="pseudoId" type="id" />
    <field name="landingPageId" type="id" />
    <field name="sectionSequence" type="number-integer" />
    <field name="sectionTitle" type="text-medium" />
    <field name="sectionDescription" type="text-long" />
    <field name="sectionImageUrl" type="text-long" />
    <field name="createdDate" type="date-time" />

    <relationship type="one" title="LandingPage" related="growerp.landing.LandingPage"
      short-alias="landingPage">
      <key-map field-name="landingPageId" />
    </relationship>
    <!-- Indices -->
    <index name="pageSection_pseudoId_idx">
      <index-field name="pseudoId" />
    </index>
    <index name="pageSection_landingPageId_idx">
      <index-field name="landingPageId" />
    </index>
  </entity>

  <!-- CredibilityInfo: Creator bio and background -->
  <entity entity-name="CredibilityInfo" package="growerp.landing" cache="true">
    <field name="credibilityInfoId" type="id" is-pk="true" />
    <field name="pseudoId" type="id" />
    <field name="landingPageId" type="id" />
    <field name="creatorBio" type="text-very-long" />
    <field name="backgroundText" type="text-very-long" />
    <field name="creatorImageUrl" type="text-long" />
    <field name="createdDate" type="date-time" />
    <field name="lastModifiedDate" type="date-time" />

    <relationship type="one" title="LandingPage"
      related="growerp.landing.LandingPage" short-alias="landingPage">
      <key-map field-name="landingPageId" />
    </relationship>
    <!-- Indices -->
    <index name="credibilityInfo_pseudoId_idx">
      <index-field name="pseudoId" />
    </index>
    <index name="credibilityInfo_landingPageId_idx">
      <index-field name="landingPageId" />
    </index>
  </entity>

  <!-- CredibilityStatistic: Supporting statistics/data for credibility -->
  <entity entity-name="CredibilityStatistic" package="growerp.landing" cache="true">
    <field name="credibilityStatisticId" type="id" is-pk="true" />
    <field name="pseudoId" type="id" />
    <field name="credibilityInfoId" type="id" />
    <field name="statistic" type="text-long" />
    <field name="sequence" type="number-integer" />
    <field name="createdDate" type="date-time" />

    <relationship type="one" title="CredibilityInfo"
      related="growerp.landing.CredibilityInfo" short-alias="credibilityInfo">
      <key-map field-name="credibilityInfoId" />
    </relationship>
    <!-- Indices -->
    <index name="credibilityStatistic_pseudoId_idx">
      <index-field name="pseudoId" />
    </index>
    <index name="credibilityStatistic_credibilityInfoId_idx">
      <index-field name="credibilityInfoId" />
    </index>
  </entity>

  <!-- CredibilityInfoAndStatistics: View combining CredibilityInfo with its statistics -->
  <view-entity entity-name="CredibilityInfoAndStatistics" package="growerp.landing">
    <member-entity entity-alias="CI" entity-name="growerp.landing.CredibilityInfo" />
    <member-entity entity-alias="CS" entity-name="growerp.landing.CredibilityStatistic"
      join-from-alias="CI" join-optional="true">
      <key-map field-name="credibilityInfoId" />
    </member-entity>

    <!-- CredibilityInfo fields -->
    <alias entity-alias="CI" name="credibilityInfoId" />
    <alias entity-alias="CI" name="pseudoId" field="pseudoId" />
    <alias entity-alias="CI" name="landingPageId" />
    <alias entity-alias="CI" name="creatorBio" />
    <alias entity-alias="CI" name="backgroundText" />
    <alias entity-alias="CI" name="creatorImageUrl" />
    <alias entity-alias="CI" name="createdDate" field="createdDate" />
    <alias entity-alias="CI" name="lastModifiedDate" />

    <!-- CredibilityStatistic fields -->
    <alias entity-alias="CS" name="credibilityStatisticId" />
    <alias entity-alias="CS" name="statisticPseudoId" field="pseudoId" />
    <alias entity-alias="CS" name="statistic" />
    <alias entity-alias="CS" name="sequence" />
    <alias entity-alias="CS" name="statisticCreatedDate" field="createdDate" />
  </view-entity>

</entities>