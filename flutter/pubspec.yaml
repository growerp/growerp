name: growerp_project
publish_to: none
environment:
  sdk: ^3.9.0
workspace:
  - packages/admin
  - packages/assessment
  - packages/freelance
  - packages/growerp
  - packages/growerp_activity
  - packages/growerp_activity/example
  - packages/growerp_catalog
  - packages/growerp_catalog/example
  - packages/growerp_chat
  - packages/growerp_chat/example
  - packages/growerp_core
  - packages/growerp_core/example
  - packages/growerp_courses
  - packages/growerp_courses/example
  - packages/growerp_inventory
  - packages/growerp_inventory/example
  - packages/growerp_marketing
  - packages/growerp_marketing/example
  - packages/growerp_models
  - packages/growerp_order_accounting
  - packages/growerp_order_accounting/example
  - packages/growerp_outreach
  - packages/growerp_outreach/example
  - packages/growerp_sales
  - packages/growerp_sales/example
  - packages/growerp_user_company
  - packages/growerp_user_company/example
  - packages/growerp_website
  - packages/growerp_website/example
  - packages/health
  - packages/hotel
  - packages/support
  - packages/website
dev_dependencies:
  melos: ^7.4.0

melos:
  name: growerp
  repository: https://github.com/growerp/growerp

  # packages also determine the order of test
  packages:
    - packages/growerp_models
    - packages/growerp_core
    - packages/growerp_core/example
    - packages/growerp_chat
    - packages/growerp_chat/example
    - packages/growerp_user_company
    - packages/growerp_user_company/example
    - packages/growerp_catalog
    - packages/growerp_catalog/example
    - packages/growerp_inventory
    - packages/growerp_inventory/example
    - packages/growerp_sales
    - packages/growerp_sales/example
    - packages/growerp_order_accounting
    - packages/growerp_order_accounting/example
    - packages/growerp_website
    - packages/growerp_website/example
    - packages/growerp_activity
    - packages/growerp_activity/example
    - packages/growerp_marketing
    - packages/growerp_marketing/example
    - packages/growerp_outreach
    - packages/growerp_outreach/example
    - packages/growerp_courses
    - packages/growerp_courses/example
    - packages/growerp
    - packages/admin
    - packages/website
    - packages/hotel
    - packages/freelance
    - packages/assessment
    - packages/health
    - packages/support

  command:
    bootstrap:
      runPubGetInParallel: false

  scripts:
    analyze:
      exec: dart analyze .
      description: Analyse all packages for possible problems.
    build:
      description: build_runner build all modules.
      run: dart run build_runner build --delete-conflicting-outputs
      exec:
        concurrency: 1
      packageFilters:
        dependsOn: build_runner
    buildclean:
      description: build_runner clean.
      exec: flutter clean && dart run build_runner clean
      packageFilters:
        dependsOn: build_runner
    watch:
      description: watch package.
      exec: dart run build_runner watch
      packageFilters:
        dependsOn: build_runner
    l10n:
      description: Generates l10n for all app packages.
      exec: flutter gen-l10n --suppress-analytics
      packageFilters:
        fileExists: "l10n.yaml"
    test_package:
      description: run all integration tests. Set BACKEND_PORT env var to override default 8080.
      exec:
        concurrency: 1
      run: flutter test integration_test --dart-define=BACKEND_PORT=${BACKEND_PORT:-8080}
      packageFilters:
        dirExists: "integration_test"
        scope: "*_example"
    test:
      description: run all app and package tests. Set BACKEND_PORT env var to override default 8080.
      exec:
        concurrency: 1
      run: flutter test integration_test --dart-define=BACKEND_PORT=${BACKEND_PORT:-8080}
      packageFilters:
        dirExists: "integration_test"
    test-headless:
      description: run all app and package tests in headless mode using flutter/ci/docker-compose-test.yml.
      exec:
        concurrency: 1
      run: $MELOS_ROOT_PATH/ci/test/set_app_settings.sh && flutter test integration_test -d emulator:5557
      packageFilters:
        dirExists: "integration_test"
